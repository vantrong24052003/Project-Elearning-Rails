<%
  course_data = {
    id: course.id,
    title: course.title,
    description: course.description,
    price: course.price,
    status: course.status,
    language: course.language,
    thumbnail_path: course.thumbnail_path,
    instructor_name: course.user.name
  }.to_json
%>

<tr id="course_<%= course.id %>" class="border-b border-gray-800 hover:bg-gray-800/50 transition-colors cursor-pointer bg-gray-900" data-action="click->data-table#showDetails" data-item="<%= course_data.html_safe %>">

  <td class="py-3 px-4" onclick="event.stopPropagation()">
    <input type="checkbox" value="<%= course.id %>" data-data-table-target="checkbox" data-action="change->data-table#toggleOne click->data-table#toggleOne" class="rounded border-gray-600 bg-gray-800 text-purple-600 focus:ring-purple-500">
  </td>

  <td class="py-3 px-4">
    <div class="flex items-center">
      <div class="w-12 h-8 rounded mr-3 bg-gray-800 overflow-hidden flex-shrink-0">
        <% if course.thumbnail_path.present? %>
        <img src="<%= course.thumbnail_path %>" alt="<%= course.title %>" class="w-full h-full object-cover">
        <% else %>
        <div class="w-full h-full flex items-center justify-center bg-purple-900/30">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-purple-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect width="18" height="18" x="3" y="3" rx="2" ry="2" />
            <circle cx="9" cy="9" r="2" />
            <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" />
          </svg>
        </div>
        <% end %>
      </div>
      <div>
        <div class="font-medium text-white"><%= course.title %></div>
        <div class="text-xs text-gray-400">Tạo: <%= course.created_at.strftime("%d/%m/%Y") %></div>
      </div>
    </div>
  </td>

  <td class="py-3 px-4 text-gray-300"><%= course.user.name %></td>
  <td class="py-3 px-4 text-purple-400 font-medium"><%= number_to_currency(course.price, unit: "₫", precision: 0, delimiter: ".") %></td>

  <td class="py-3 px-4" onclick="event.stopPropagation()">
    <div class="flex items-center gap-2">
      <span class="<%= course.status == 'published' ? 'bg-green-900/30 text-green-400' : 'bg-yellow-900/30 text-yellow-400' %> px-2.5 py-1 rounded-full text-xs inline-flex items-center">
        <% if course.status == 'published' %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 6 9 17l-5-5" />
        </svg>
        Đã xuất bản
        <% else %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 2v10M12 16h.01" />
        </svg>
        Bản nháp
        <% end %>
      </span>

      <div class="relative" data-controller="shared--dropdown">
        <button type="button" class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors" data-action="shared--dropdown#toggle click@window->shared--dropdown#hide">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>

        <div data-shared--dropdown-target="menu" class="absolute left-0 mt-2 w-48 bg-gray-800 border border-gray-700 rounded-md shadow-lg z-10 hidden">
          <% if course.status == 'published' %>
          <%= button_to draft_manage_course_path(course),
                method: :post,
                form: { data: { turbo: true, turbo_stream: true } },
                class: "w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700 flex items-center" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-yellow-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
            <path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z" />
          </svg>
          Chuyển thành bản nháp
          <% end %>
          <% else %>
          <%= button_to publish_manage_course_path(course),
                method: :post,
                form: { data: { turbo: true, turbo_stream: true } },
                class: "w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700 flex items-center" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 6 9 17l-5-5" />
          </svg>
          Xuất bản
          <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </td>

  <td class="py-3 px-4 text-right">
    <div class="row-actions inline-flex gap-1 justify-end" >
      <%= link_to edit_manage_course_path(course), data: { turbo_frame: "modal" }, class: "action-btn p-1.5 bg-gray-800 hover:bg-gray-700 rounded text-blue-400 transition-colors", title: "Chỉnh sửa" do %>
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
        <path d="m15 5 4 4" />
      </svg>
      <% end %>

      <a href="<%= manage_course_path(course) %>" class="action-btn p-1.5 bg-gray-800 hover:bg-gray-700 rounded text-purple-400 transition-colors" title="Xem chi tiết" data-action="click->data-table#showDetails" data-turbo="false">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
          <circle cx="12" cy="12" r="3" />
        </svg>
      </a>

      <%= button_to manage_course_path(course),
          method: :delete,
          form: { data: { turbo: true, turbo_stream: true, turbo_confirm: "Bạn có chắc chắn muốn xóa khóa học này không?" } },
          class: "action-btn p-1.5 bg-gray-800 hover:bg-gray-700 rounded text-red-400 transition-colors",
          title: "Xóa" do %>
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 6h18" />
        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
      </svg>
      <% end %>
    </div>
  </td>
</tr>
